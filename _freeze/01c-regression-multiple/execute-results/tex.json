{
  "hash": "418e6d14ee8b38be9139386c54e6c8aa",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Introduction to Statistical Modeling\"\nsubtitle: \"Multiple Linear Regression\"\nauthor: \"Joris Vankerschaver\"\npdf-engine: lualatex\nformat:\n  beamer:\n    theme: Pittsburgh\n    colortheme: default\n    fonttheme: default\n    include-in-header:\n      - file: header.tex\n---\n\n\n\n\n## Example: Mineral composition versus growth\n\n:::: {.columns}\n::: {.column width=\"50%\"}\n- Case study: 26 8-year-old Japanese larches\n- **Goal**: study association between height $Y$ of tree (in cm) and mineral composition of needles:\n  - Nitrogen $X_N$\n  - Phosphorus $X_P$\n  - Potassium $X_K$\n  - Residual ash $X_r$\n- Independent variables expressed in percentage observed in dried needles.\n:::\n\n::: {.column width=\"50%\"}\n![](./images/01-linear-regression/Larix-kaempferi.jpeg)\n\\scriptsize\nImage source: [Wikipedia](https://en.wikipedia.org/wiki/Larix_kaempferi).\n:::\n::::\n\n## Simple linear regression not possible\n\n- Separate linear regression models\n$$\n  E(Y|X_P)=\\alpha+\\beta_P X_P\n$$\nonly allow to predict based on 1 mineral.\n- More accurate predictions based on all minerals simultaneously.\n- Separate models might not show **pure effect**\n  - $\\beta_P$ is mean difference in length between trees that differ 1 unit in proportion phosphorus.\n  - **Confounding**: even if phosphorus would not have influence on length, trees with higher level of phosphorus might be taller because they contain, for example, more potassium.\n  - Necessity to compare trees with different level of phosphorus, but same level of potassium.\n\n## Multiple linear regression\n\n- Assume that \n$$\n  E(Y|X_N,X_P,X_K,X_r)=\\alpha + \\beta_N X_N+ \\beta_P X_P + \\beta_K X_K +\\beta_r X_r\n$$\nfor unknown **intercept** $\\alpha$ and **slopes** $\\beta_N, \\beta_P, \\beta_K, \\beta_r$.\n\n- Now prediction based on multiple minerals possible.\n- Confounding partially circumvented: \n\\begin{eqnarray*}\n&&E(Y|X_N,X_P=x_P+\\delta,X_K,X_r) \\\\ && \\hspace*{1cm} -E(Y|X_N,X_P=x_P,X_K,X_r)\\\\\n&&=\\alpha + \\beta_N X_N + \\beta_P (x_P+\\delta)+ \\beta_K X_K +\\beta_r X_r\\\\\n&&\\hspace*{1cm}-\\alpha - \\beta_N X_N- \\beta_P x_P- \\beta_K X_K -\\beta_r X_r = \\beta_P\\delta\n\\end{eqnarray*}\n$\\beta_P=$ difference in mean length between trees that differ 1 unit in proportion phosphorus, but have **same value for other explaining variables**.\n\n## Analysis of larches\n\n\\small\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_l <- lm(length ~ phosphor)\nsummary(model_l)$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate Std. Error   t value    Pr(>|t|)\n(Intercept)  -69.10736   45.99195 -1.502597 1.45988e-01\nphosphor    1060.29029  177.07503  5.987802 3.51108e-06\n```\n\n\n:::\n:::\n\n\\normalsize\n\nWe call in this case the association between phosphorus and length **unadjusted**.\n\n## Analysis of larches\n\nParameters estimated using least squares method:\n\n\\small\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate Std. Error   t value     Pr(>|t|)\n(Intercept) -185.32987   36.29808 -5.105776 4.670943e-05\nnitrogen      97.76404   24.57181  3.978708 6.836171e-04\nphosphor     256.97496  169.90534  1.512460 1.453213e-01\npotassium    126.57293   46.42886  2.726169 1.265285e-02\nresidu        40.27678   36.61454  1.100021 2.837734e-01\n```\n\n\n:::\n:::\n\n\n\\normalsize\nWe say in this case that the association between phosphorus and length is **adjusted** for nitrogen, potassium, and residual ash.\n\n## Tests and confidence intervals \n\n- Tests and confidence intervals for parameter $\\beta$ based on\n$$\n  \\frac{\\hat{\\beta}-\\beta}{SE(\\hat{\\beta})}\\sim t_{n-p}\n$$\nwith $p$ number of unknown parameters in model.\n- Or directly using\n\n::: {.cell}\n\n```{.r .cell-code}\nconfint(model_l2)\n```\n:::\n\n\n## Analysis of larches \n\\small\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate Std. Error   t value     Pr(>|t|)\n(Intercept) -185.32987   36.29808 -5.105776 4.670943e-05\nnitrogen      97.76404   24.57181  3.978708 6.836171e-04\nphosphor     256.97496  169.90534  1.512460 1.453213e-01\npotassium    126.57293   46.42886  2.726169 1.265285e-02\nresidu        40.27678   36.61454  1.100021 2.837734e-01\n```\n\n\n:::\n:::\n\n\\normalsize\n\n- **95\\% CI** for $\\beta_N$ needs $t_{21,0.975}=2.08$\n$$\n  [97.76 \\pm 2.08\\times 24.57]=[46.66, 148.86].\n$$\n- **95\\% CI** for $\\beta_P$\n$$\n  [256.97 \\pm 2.08\\times 169.91]=[-96.36, 610.31].\n$$\n\n\n## Analysis of larches: individual residual plots\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](01c-regression-multiple_files/figure-beamer/unnamed-chunk-7-1.pdf)\n:::\n:::\n\n\n## Analysis of larches: residual plots\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](01c-regression-multiple_files/figure-beamer/unnamed-chunk-8-1.pdf)\n:::\n:::\n\n\n## Interaction or effect modification\n\n- **Interaction** or **effect modification**: effect of variable $X$ on outcome $Y$ depends on third variable $Z$.\n- Examples:\n  - Effect of nitrogen on growth depends on proportion phosphorus\n  - Pharmacogenetics: effect of steroids for asthma on lung function depends on certain genes.\n  - Gene-environment interactions: effect of certain genes on COPD depends on history of smoking.\n- Model interactions through **cross-product term**:\n$$\n  E(Y|X_N,X_P)=\\alpha + \\beta_N X_N+ \\beta_P X_P+ \\beta_{NP} X_NX_P.\n$$\n\n## Interpretation\n\n\\begin{align*}\nE(Y| & X_N=x_N+1,X_P)-E(Y|X_N=x_N,X_P)\\\\\n &=\\alpha + \\beta_N (x_N+1)+ \\beta_P X_P+ \\beta_{NP} (x_N+1)X_P\\\\\n &\\hspace*{1cm}-\\alpha - \\beta_N x_N- \\beta_P X_P- \\beta_{NP} x_N X_P\\\\\n &=\\beta_N+\\beta_{NP}X_P.\n\\end{align*}\n\n- $\\beta_{NP}$ is difference in nitrogen **effect** between trees that differ 1 percentage in phosphorus.\n- Decide whether nitrogen effect depends on quantity phosphorus can be done by testing if $\\beta_{NP}=0$.\n- $\\beta_N$ is effect of 1 percentage increase in nitrogen when percentage phosphorus is 0.\n\n\n## Analysis of larches with interaction\n\n\\scriptsize\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_l3 <- lm(length ~ nitrogen * phosphor)\nsummary(model_l3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = length ~ nitrogen * phosphor)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-57.533 -32.025   0.205  23.121 107.795 \n\nCoefficients:\n                  Estimate Std. Error t value Pr(>|t|)  \n(Intercept)         198.42     211.94   0.936   0.3593  \nnitrogen            -79.04     111.67  -0.708   0.4865  \nphosphor           -971.01     858.65  -1.131   0.2703  \nnitrogen:phosphor   794.97     426.20   1.865   0.0755 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 42.99 on 22 degrees of freedom\nMultiple R-squared:  0.8216,\tAdjusted R-squared:  0.7973 \nF-statistic: 33.78 on 3 and 22 DF,  p-value: 2.057e-08\n```\n\n\n:::\n:::\n\n\\normalsize\n\n## Predicted association (full model, interaction)\n\n![](./images/01-linear-regression/needles-interaction.png)\n\nInteractive visualization at \n\\url{https://shiny-stats.fly.dev/multi-regression/}\n\n## Predicted association (left) and effect (right)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](01c-regression-multiple_files/figure-beamer/unnamed-chunk-10-1.pdf){fig-align='center' width=4in height=4in}\n:::\n:::\n\n\n\n\n## Analysis of larches without interaction\n\n\\scriptsize\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_l4 <- lm(length ~ nitrogen + phosphor)\nsummary(model_l4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = length ~ nitrogen + phosphor)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-57.834 -34.950  -0.539  20.364 127.287 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  -189.64      42.53  -4.460 0.000179 ***\nnitrogen      123.83      26.62   4.652 0.000111 ***\nphosphor      604.44     162.65   3.716 0.001135 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 45.25 on 23 degrees of freedom\nMultiple R-squared:  0.7934,\tAdjusted R-squared:  0.7755 \nF-statistic: 44.17 on 2 and 23 DF,  p-value: 1.329e-08\n```\n\n\n:::\n:::\n\n\\normalsize\n\n\n## Predicted association (full model, no interaction)\n\n![](./images/01-linear-regression/needles-no-interaction.png)\n\n## Predicted association (left) and effect (right)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](01c-regression-multiple_files/figure-beamer/unnamed-chunk-12-1.pdf){fig-align='center' width=4in height=4in}\n:::\n:::\n\n\n## Constructing statistical models\n\nStatistical models are built hierarchically by adding or removing one predictor at a time:\n\n- **Forward** model construction: starts from empty model.\n- **Backward** model construction: starts from full model, i.e., one that contains all available predictors.\n- **Stepwise** model construction: combination of both.\n\n\n## Constructing statistical models\n\n**Forward** model construction:\n\n- Include predictors **1 by 1**\n- After each inclusion:\n  - Verify if certain predictors in the model are no longer significantly associated with outcome.\n  - Remove those **1 by 1** until model contains only significant predictors.\n- Repeat until no inclusion is significant\n\n**Backward** model construction: \n\n- Exclude 1 by 1 the **nonsignificant** predictors.\n- Until model only contains significant predictors.\n\nIn either case, the included (excluded) predictor is ideally the one that is most (least) strongly associated with outcome, after verification for the other predictors in the model.\n\n\n## Constructing statistical models\n\n- Once all **first order terms** have been verified, investigate **higher order terms** (interactions, quadratic effects, ...)\n- This is **not** done in exhaustive way:\n  - Because number of higher order terms can get very large.\n  - Because problem of multiple testing might sometimes lead relatively easy by mere coincidence to incorrect conclusion that certain higher order term is significant.\n\n- Higher order terms considered for inclusion based on:\n  - Biological judgment\n  - Insight from residual plots.\n\n- Once final model is obtained, verify through residual plots.\n\n\n## Analysis of larches: provisonally `final' model\n\n\\small\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                    Estimate Std. Error    t value    Pr(>|t|)\n(Intercept)         129.0901  169.32526  0.7623795 0.455194582\nnitrogen           -150.7635   97.07997 -1.5529827 0.136925913\nphosphor          -1000.0165  682.98384 -1.4641877 0.159492670\npotassium           137.9659   41.23717  3.3456675 0.003396905\nresidu              193.8021   89.10355  2.1750205 0.042462293\nnitrogen:phosphor   951.7823  371.56807  2.5615287 0.019086203\nphosphor:residu    -598.0778  290.01979 -2.0621964 0.053134178\n```\n\n\n:::\n:::\n\n\n\\begin{verbatim}\nResidual standard error: 33.43 on 19 degrees of freedom\nMultiple R-squared:  0.9069,\tAdjusted R-squared:  0.8774 \nF-statistic: 30.83 on 6 and 19 DF,  p-value: 8.159e-09\n\\end{verbatim}\n\n## Constructing statistical models\n\n\n- How to build statistical models **depends ideally on goal** of these models:\n  - Making predictions\n  - Determining effect of an exposure on an outcome.\n\n- To make predictions, previous strategy is sensible since it aims at avoiding overfitting.\n- To determine effect of an exposure on an outcome, must make sure above all to adjust for all confounders\n- Recall: Confounder are factors\n  - that are not comparable between exposure groups\n  - in particular, that are associated with outcome and exposure, but are not influenced by either.\n\n",
    "supporting": [
      "01c-regression-multiple_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}